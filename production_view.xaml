!!!xml1.0

~openerp
    ~data

        // top menu item
        ~menuitem @FnxPd #menu_fnx_pd_root groups='group_fnx_pd_operator'

        // first menu item
        ~menuitem @Production #menu_fnx_pd_orders parent='menu_fnx_pd_root' sequence='10' groups='group_fnx_pd_user'

        // main order views
        ~record model='ir.ui.view' #fnx_pd_order_tree
            @name: fnx_pd_order_tree
            @model: fnx.pd.order
            @priority eval='10'
            @arch type='xml'
                ~tree string='Tree View' toolbar='1' create='false' colors="green:(state=='sequenced' and confirmed) or state in ['running','stopped','complete'];red:state=='draft' and confirmed;blue:state=='sequenced';gray:state in ['cancelled','complete'];purple:sequence==0;"
                    @dept invisible='1'
                    @order_no
                    @line_id
                    @item_id
                    @schedule_date
                    @sequence invisible='1'
                    @confirmed invisible='1'
                    @allergens
                    @coating
                    @state
                
        ~record model='ir.ui.view' #fnx_pd_order_form
            @name: fnx_pd_order_form
            @model: fnx.pd.order
            @priority eval='10'
            @arch type='xml'
                ~form $Production_Orders version='7.0' create='false'
                    ~header
                        @state widget='statusbar' statusbar_visible='draft,sequenced,running,complete'
                    ~sheet
                        ~div .oe_right .oe_button_box @button_box
                            ~button $Release_to_floor groups='fnx_pd.group_fnx_pd_user' name='pd_state' states='draft' type='object' context="{'new_state': 'sequenced'}"
                            ~button $Recall_from_floor groups='fnx_pd.group_fnx_pd_user' name='pd_state' states='sequenced' type='object' context="{'new_state': 'draft'}"
                        ~group
                            ~group
                                ~div
                                    ~h1
                                        ~label for='order_no' $Order
                                        @order_no readonly='True'
                                    ~h2
                                        ~label for="item_id" $Item
                                        @item_id readonly='True' .oe_inline options="{'create':False, 'create_edit':False}"
                        ~group
                            ~group
                                @schedule_date
                                @schedule_date_set groups='fnx_pd.group_fnx_pd_manager' $Allow_nightly_update
                                @confirmed readonly='True' colspan='2'
                            ~group
                                @finish_date readonly='True'
                                @completed_fis_qty readonly='True'
                        ~group
                            ~group
                                @coating
                                @allergens
                            ~group
                                @dept
                                @line_id
                                @line_id_set groups='fnx_pd.group_fnx_pd_manager' $Allow_nightly_update
                        ~notebook
                            ~page $Manager_Overrides visible="groups('fnx_pd.group_fnx_pd_manager')"
                                ~separator $Reset_state_to
                                ~button $Scheduled name='pd_state' type='object' context="{'new_state': 'draft'}"
                                ~button $Sequenced name='pd_state' type='object' context="{'new_state': 'sequenced'}"
                                ~button $Running name='pd_state' type='object' context="{'new_state': 'running'}"
                                ~button $Stopped name='pd_state' type='object' context="{'new_state': 'stopped'}"
                                ~button $Complete name='pd_state' type='object' context="{'new_state': 'complete'}"
                                ~button $Cancelled name='pd_state' type='object' context="{'new_state': 'cancelled'}"
                    ~div .oe_chatter
                        @message_follower_ids widget='mail_followers'
                        @message_ids widget='mail_thread' nolabel='1' 

        ~record model='ir.ui.view' #search_fnx_pd_orders
            @name: Production Orders Search
            @model: fnx.pd.order
            @arch type='xml'
                ~search string='Search Production Orders'
                    @state $Status
                    @item_id $Product
                    @coating $Coating
                    @allergens $Allergens
                    ~separator
                    ~filter $All_Open @type_open domain="[('state','in',['draft','sequenced','running','stopped'])]"
                    ~filter $In_Progress @type_progress domain="[('state','in',['running','stopped'])]"
                    ~filter $Closed @type_closed domain="[('state','in',['complete','cancelled'])]"
                    ~separator
                    ~filter $Scheduled @type_draft domain="[('state','=','draft')]"
                    ~filter $Sequenced @type_scheduled domain="[('state','=','sequenced')]"
                    ~filter $Running @type_running domain="[('state','=','running')]"
                    ~filter $Paused @type_ready domain="[('state','=','stopped')]"
                    ~filter $Complete @type_complete domain="[('state','=','complete')]"
                    ~filter $Cancelled @type_cancelled domain="[('state','=','cancelled')]"
                    ~separator
                    ~group expand='0' string='Group by...'
                        // ~filter $Line domain='[]' context="{'group_by': 'line_id', 'order_by': 'schedule_date'}"
                        ~filter $Allergens domain='[]' context="{'group_by': 'allergens'}"
                        ~filter $Coating domain='[]' context="{'group_by': 'coating'}"
                        ~filter $Department domain='[]' context="{'group_by': 'dept'}"

        ~record model='ir.actions.act_window' #action_fnx_pd_form_orders
            @name: Orders
            @res_model: fnx.pd.order
            @view_type: form
            @view_id ref='fnx_pd_order_tree'
            @view_mode: tree,form
            @search_view_id ref='search_fnx_pd_orders'
            @context eval="{'search_default_type_open':1}"
            @limit eval='200'

        ~menuitem $Orders #menu_item_fnx_pd_orders_all parent='menu_fnx_pd_orders' sequence='10' action='action_fnx_pd_form_orders'

        ~record model='ir.actions.act_window' #action_fnx_pd_form_closed_orders
            @name: Closed/Cancelled Orders
            @res_model: fnx.pd.order
            @view_type: form
            @view_id ref='fnx_pd_order_tree'
            @view_mode: tree,form
            @domain: [('state','in',['complete','cancelled'])]
            @limit eval='200'

        ~menuitem $Closed_Orders #menu_item_fnx_pd_orders_closed parent='menu_fnx_pd_orders' sequence='20' action='action_fnx_pd_form_closed_orders'

        ~record model='ir.ui.view' #fnx_pd_order_operator_tree
            @name: fnx_pd_order_tree
            @model: fnx.pd.order
            @priority eval='20'
            @arch type='xml'
                ~tree string='Tree View' create='false'
                    @order_no
                    @line_id invisible='1'
                    @item_id
                    @schedule_date
                    @allergens
                    @coating
                    @state
                
        ~record model="ir.ui.view" #fnx_pd_production_line_tree
            @name: Production Lines
            @model: fis_integration.production_line
            @arch type='xml'
                ~tree string="Production Lines" create='false'
                    @name
                    @order_totals

        ~record model='ir.ui.view' #fnx_pd_production_line_form
            @name: Production Lines
            @model: fis_integration.production_line
            @arch type='xml'
                ~form $Production_Lines version='7.0'
                    ~h1
                        @desc readonly='True'
                    ~notebook
                        ~page $Schedule
                            @order_ids nolabel='1'
                                ~tree create='0' delete='0' editable='top' colors="green:(state=='sequenced' and confirmed) or state in ['running','stopped','complete'];red:state=='draft' and confirmed;blue:state=='sequenced';gray:state in ['cancelled','complete'];purple:sequence==0;"
                                    ~button $Release name='pd_list_release' states='draft' type='object'
                                    ~button $Recall name='pd_list_recall' states='sequenced' type='object'
                                    @order_no readonly='1'
                                    @item_id readonly='1'
                                    @schedule_date
                                    @sequence invisible='1'
                                    @confirmed invisible='1'
                                    @allergens readonly='1'
                                    @coating readonly='1'
                                    @state readonly='1'

        ~record model='ir.actions.act_window' #action_fnx_pd_production_line
            @name: Production Lines
            @res_model: fis_integration.production_line
            @view_type: form
            @view_id ref='fnx_pd_production_line_tree'
            @view_mode: tree,form
            @domain: [('desc','!=','Open')]

        ~record model='ir.actions.act_window.view' #action_view_fnx_pd_production_line
            @sequence eval='20'
            @view_mode: tree
            @view_id ref='fnx_pd_production_line_tree'
            @act_window_id ref='action_fnx_pd_production_line'

        ~record model='ir.actions.act_window.view' #action_view_fnx_pd_production_form
            @sequence eval='21'
            @view_mode: form
            @view_id ref='fnx_pd_production_line_form'
            @act_window_id ref='action_fnx_pd_production_line'

        ~menuitem name='Lines' #menu_fnx_pd_production_lines parent='menu_fnx_pd_orders' sequence='30' action='action_fnx_pd_production_line' groups='fnx_pd.group_fnx_pd_user' 

        ~menuitem @Operator #menu_fnx_pd_operator parent='menu_fnx_pd_root' sequence='30'

        ~record model="ir.ui.view" #fnx_pd_production_line_operator_tree
            @name: Production Lines
            @model: fis_integration.production_line
            @arch type='xml'
                ~tree string="Production Lines" create='false'
                    @name
                    @order_run_total

        ~record model='ir.ui.view' #fnx_pd_production_line_operator_form
            @name: Lines
            @model: fis_integration.production_line
            @arch type='xml'
                ~form $Production_Lines version='7.0' create='0' delete='0' edit='0'
                    ~h1
                        @desc readonly='True'
                    ~notebook
                        ~page $Jobs
                            @order_ids nolabel='1'
                                ~tree colors="green:(state=='sequenced' and confirmed) or state in ['running','stopped','complete'];red:state=='draft' and confirmed;blue:state=='sequenced';gray:state in ['cancelled','complete'];purple:sequence==0;"
                                    ~button string='Start Job' name='pd_job_start' states='sequenced,stopped' type='object'
                                    ~button string='Stop Job' name='pd_job_stop' states='running' type='object'
                                    @order_no
                                    @item_id
                                    @sequence invisible='1'
                                    @confirmed invisible='1'
                                    @allergens
                                    @coating
                                    @schedule_date
                                    @state

        ~record model='ir.actions.act_window' #action_fnx_pd_production_operator_line
            @name: Lines
            @res_model: fis_integration.production_line
            @view_type: form
            @view_id ref='fnx_pd_production_line_tree'
            @view_mode: tree,form
            @domain: [('desc','!=','Open')]
            @context eval="{'fnx.pd.order_domain': [('schedule_date','<=','TODAY'), ('state','!=','draft')]}"

        ~record model='ir.actions.act_window.view' #action_view_fnx_pd_production_operator_tree
            @sequence eval='20'
            @view_mode: tree
            @view_id ref='fnx_pd_production_line_operator_tree'
            @act_window_id ref='action_fnx_pd_production_operator_line'

        ~record model='ir.actions.act_window.view' #action_view_fnx_pd_production_operator_form
            @sequence eval='21'
            @view_mode: form
            @view_id ref='fnx_pd_production_line_operator_form'
            @act_window_id ref='action_fnx_pd_production_operator_line'

        ~menuitem name='Lines' #menu_fnx_pd_production_operator_lines parent='menu_fnx_pd_operator' sequence='20' action='action_fnx_pd_production_operator_line'
